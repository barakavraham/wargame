{% extends 'layout.html' %}

{% block styles %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/battle_results.css') }}">
{% endblock styles %}
{% block title %} <title> Battle results </title> {% endblock title %}
{% if current_user.army == battle_result.attacker_army %}
    {% set main_army = battle_result.attacker_army %}
    {% set main_result = battle_result.attacker_result %}
    {% set secondary_army = battle_result.attacked_army %}
    {% set secondary_result = battle_result.attacked_result %}
    {% if battle_result.did_attacker_win == 1 %}
        {% set did_win = 1 %}
    {% elif battle_result.did_attacker_win == 0  %}
        {% set did_win = 0 %}
    {% else %}
        {% set did_win = 2 %}
    {% endif %}   
{% else %}
    {% set main_army = battle_result.attacked_army %}
    {% set main_result = battle_result.attacked_result %}
    {% set secondary_army = battle_result.attacker_army %}
    {% set secondary_result = battle_result.attacker_result %}
    {% if battle_result.did_attacker_win == 1 %}
        {% set did_win = 0 %}
    {% elif battle_result.did_attacker_win == 0  %}
        {% set did_win = 1 %}
    {% else %}
        {% set did_win = 2 %}
    {% endif %}   
{% endif %}
{% set is_winner = battle_result.did_attacker_win and current_user.army == battle_result.attacker_army %}

{% block content %}
    {% if did_win == 1 %}
        <h4 class="text-center" style="color: green;">You won the battle!</h4>
    {% elif did_win == 0 %}
        <h4 class="text-center" style="color: red;">You lost the battle!</h4>
    {% elif did_win == 2 %}
        <h4 class="text-center" style="color: orange;">Its a tie!</h4>
    {% endif %}
    <div class="battle-results d-flex justify-content-evenly mt-5">
        <div class="main-avatar d-flex flex-column justify-content-center align-items-center">
            {% if main_army.user.is_google_user == True %}
                <img class="avatar" src="{{ main_army.user.avatar }}" alt="{{ main_army.name }}"/>
            {% else %}
                <img class="avatar" src="{{ url_for('static', filename='images/'+main_army.user.avatar) }}" alt="{{ main_army.name }}"/>
            {% endif %}
        </div>
        <div class="results d-flex justify-content-between w-100">
            <div class="main ml-5">
                <div class="d-flex justify-content-between align-items-center">
                    <img class="mx-2" src="{{ url_for('static', filename='images/swords.png') }}" alt="swords" />
                    <h3>{{ main_army.name }}</h3>
                </div>
                <h5 class="text-center mt-1" style="color: red;font-size: 1.2rem;">Weapons lost:</h5>
                {% for result in main_result %}
                    <p class="text-center"><img src="{{ url_for('static', filename='images/'+shop_items[result].picture_name) }}"
                            alt="{{ shop_items[result].display_name }}" /> {{ main_result[result] }}</p>
                {% endfor %}
            </div>
            <div class="secondary mr-5">
                <div class="d-flex justify-content-between align-items-center">
                    <h3>{{ secondary_army.name }}</h3>
                    <img class="mx-2" src="{{ url_for('static', filename='images/swords.png') }}" alt="swords" />
                </div>
                <h5 class="text-center mt-1" style="color: red;font-size: 1.2rem;">Enemy weapons lost:</h5>
                {% for result in secondary_result %}
                    <p class="text-center">{{ secondary_result[result] }} <img src="{{ url_for('static', filename='images/'+shop_items[result].picture_name) }}"
                                                        alt="{{ shop_items[result].display_name }}" /></p>
                {% endfor %}
            </div>
        </div>
        <div class="secondary-avatar d-flex flex-column justify-content-center align-items-center">
            {% if secondary_army.user.is_google_user == True %}
                <img class="avatar" src="{{ secondary_army.user.avatar }}" alt="{{ main_army.name }}"/>
            {% else %}
                <img class="avatar" src="url_for('static', filename='images/'+secondary_army.user.user.avatar)" alt="{{ main_army.name }}"/>
            {% endif %}
        </div>
    </div>
{% endblock content %}
